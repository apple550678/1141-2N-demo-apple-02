### w13

```
blogcontext

'use client' // 宣告這是客戶端元件 (Next.js 13+ 需要)

import { useState, createContext, useContext } from 'react'
// 匯入原始資料 (JSON 檔)
import blogData_02 from '../../_assets/data/blogData.json'

// 1. 建立一個 Context (像是建立一個全域的資料儲存區)
const BlogContext = createContext()

// 2. 建立 Provider 元件 (供應商)
// 這個元件會把資料和方法包起來，傳給裡面的子元件 (children)
export const BlogContextProvider_02 = ({ children }) => {
  // --- 定義狀態 (State) ---
  const [name, setName] = useState('李國蘋') // 你的名字
  const [id, setId] = useState(213410102)    // 你的學號
  const [blogs_02, setBlogs_02] = useState(blogData_02) // 文章列表，預設讀取 JSON

  // Alert 的狀態：控制顯示(show)、訊息(msg)、類型(type: success/danger)
  const [alert, setAlert] = useState({
    show: false,
    msg: '',
    type: '',
  })

  // --- 定義功能函式 (Functions) ---

  // 顯示通知的輔助函式 (預設參數為不顯示)
  const showAlert = (show = false, msg = '', type = '') => {
    setAlert({ show, msg, type })
  }

  // 刪除單篇文章的功能
  const removeItem = (id) => {
    showAlert(true, 'blog removed', 'danger') // 跳出紅色警告通知
    // 使用 filter 過濾掉該 id 的文章，剩下的就是新的列表
    setBlogs_02(blogs_02.filter((blog) => blog.id !== id))
  }

  // 清空所有文章的功能
  const clearAllBlogs = () => {
    showAlert(true, 'clear all blogs', 'danger') // 跳出紅色警告通知
    setBlogs_02([]) // 把陣列設為空的 []
  }

  // 重新載入所有文章的功能
  const loadAllBlogs = () => {
    showAlert(true, 'load all blogs', 'success') // 跳出綠色成功通知
    setBlogs_02([]) // 先清空 (可選)
    setBlogs_02(blogData_02) // 重新把 JSON 資料塞回去
  }

  // --- 回傳 Provider ---
  // value 屬性裡面的東西，就是所有子元件可以拿到的「寶藏」
  return (
    <BlogContext.Provider
      value={{
        blogs_02,      // 資料：文章列表
        name,          // 資料：名字
        id,            // 資料：學號
        alert,         // 資料：通知狀態
        showAlert,     // 函式：顯示通知
        removeItem,    // 函式：刪除單篇
        clearAllBlogs, // 函式：清空全部
        loadAllBlogs,  // 函式：載入全部
      }}
    >
      {children}
    </BlogContext.Provider>
  )
}

// 3. 自定義 Hook (方便在其他檔案取用資料)
// 這樣其他元件只要呼叫 useBlogContext_02() 就可以拿到 value 裡的東西
export const useBlogContext_02 = () => {
  return useContext(BlogContext)
}
```

```
page

'use client'

import { useState } from 'react'

// 匯入我們剛剛寫好的 Context Provider 和 Hook
import { BlogContextProvider_02, useBlogContext_02 } from './_blogContext_02'
// 匯入樣式包裹器 (CSS Wrapper)
import Wrapper from '../../_assets/wrapper/Blog2_02'
// 匯入元件
import Alert_02 from '../../_components/Alert_02'
import BlogList2_02 from './_components/BlogList2_02'

// --- 主頁面元件 ---
const BlogLocalJsonPage2_02 = () => {
  return (
    // 最外層必須用 Provider 包起來，裡面的 Context_02 才能拿到資料
    <BlogContextProvider_02>
      <Context_02 />
    </BlogContextProvider_02>
  )
}

// --- 內容元件 (真正顯示畫面的地方) ---
const Context_02 = () => {
  // 使用 Hook 從 Context 裡面把需要的資料和函式拿出來
  const { name, id, alert, showAlert, clearAllBlogs, loadAllBlogs } =
    useBlogContext_02()

  return (
    <Wrapper>
      {/* 條件渲染：如果 alert.show 是 true，才顯示 Alert_02 元件 */}
      {alert.show && <Alert_02 alert={alert} showAlert={showAlert} />}

      <section className='blogs'>
        {/* 標題區塊：顯示你的學號跟姓名 */}
        <div className='section-title'>
          <h2>
            blogs context from local json 2 -- {name}, {id}
            {''}
          </h2>
        </div>

        {/* 文章列表元件 (它自己會去 Context 拿資料，所以這裡不用傳 props) */}
        <BlogList2_02 />

        {/* 按鈕區塊 */}
        <div className='flex justify-center items-center gap-8 mt-8'>
          {/* 清除全部按鈕 (紅色) */}
          <button
            type='button'
            className='text-red-700 bg-red-200 hover:bg-red-300 capitalize px-4 py-2 text-base rounded'
            onClick={clearAllBlogs} // 點擊時執行 Context 裡的函式
          >
            clear all blogs
          </button>

          {/* 重新載入按鈕 (藍色) */}
          <button
            type='button'
            className='text-blue-700 bg-blue-200 hover:bg-blue-300 capitalize px-4 py-2 text-base rounded'
            onClick={loadAllBlogs} // 點擊時執行 Context 裡的函式
          >
            load all blogs
          </button>
        </div>
      </section>
    </Wrapper>
  )
}

export default BlogLocalJsonPage2_02
```

```
alert

import { useEffect } from 'react'

// 接收 props: alert (訊息內容) 和 showAlert (用來關閉訊息的函式)
const Alert_02 = ({ alert, showAlert }) => {

  // useEffect 用來處理副作用 (這裡是計時器)
  useEffect(() => {
    // 設定一個計時器，3000毫秒 (3秒) 後執行
    const timeout = setTimeout(() => {
      showAlert() // 呼叫不帶參數的 showAlert，預設會把 show 變成 false (關閉通知)
    }, 3000)

    // 清理函式 (Cleanup function)
    // 如果使用者在3秒內又觸發了一次通知，這行會清除上一個計時器，避免衝突
    return () => clearTimeout(timeout)
  }, [alert]) // 監聽 [alert]，只要 alert 狀態一變，這個 useEffect 就會跑一次

  // --- 根據 alert.type 決定顯示什麼顏色 ---

  // 成功訊息 (綠色)
  if (alert.type === 'success') {
    return (
      <p className='grid items-center text-center capitalize text-green-700 bg-green-200'>
        {alert.msg}
      </p>
    )
  }
  // 危險/警告訊息 (紅色)
  else if (alert.type === 'danger') {
    return (
      <p className='grid items-center text-center capitalize text-red-700 bg-red-200'>
        {alert.msg}
      </p>
    )
  }
}

export default Alert_02
```

```
bloglist

import Wrapper from '../../../_assets/wrapper/Blog2_02'
import Blog2_02 from './Blog2_02' // 引入單篇文章元件
import { useBlogContext_02 } from '../_blogContext_02' // 引入 Hook

const BlogList2_02 = () => {
  // 從 Context 取出文章列表資料 (blogs_02)
  const { blogs_02 } = useBlogContext_02()

  return (
    <Wrapper>
      <div className='blogs-center'>
        {/* 使用 map 迴圈遍歷陣列，把每一筆資料轉成元件 */}
        {blogs_02?.map((item) => {
          // 解構賦值：把 item 裡面的屬性拆出來
          const { id, title, descrip, category, img } = item
          return (
            // 渲染單篇文章元件，並把資料透過 props 傳進去
            <Blog2_02
              key={id}       // React 列表渲染必須要有唯一的 key
              id={id}
              title={title}
              descrip={descrip}
              category={category}
              img={img}
            />
          )
        })}
      </div>
    </Wrapper>
  )
}

export default BlogList2_02
```
